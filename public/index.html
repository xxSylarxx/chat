<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat en Tiempo Real</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@100..800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Sora', sans-serif;
            background: #fff;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .chat-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background: #fff;
        }

        .chatbot-header {
            background: #f2f8ff;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e0e0e0;
        }

        .cubibot-header {
            display: flex;
            align-items: center;
        }

        .cubibot-icon {
            margin-top: auto;
            margin-bottom: auto;
        }

        .cubibot-icon svg {
            width: 50px;
            height: 50px;
        }

        .cubibot-title {
            font-family: 'Sora', sans-serif;
            font-size: 1.2rem;
            color: #1a1a1a;
            margin: 5px 0 2px 0;
        }

        .cubibot-status {
            font-size: 0.9rem;
            color: #4caf50;
            margin: 0;
        }

        .cubibot-status:before {
            content: "";
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: #4caf50;
            border-radius: 50%;
            margin-right: 6px;
        }

        #chatbot-close {
            background: transparent;
            border: none;
            color: #8f8f8f;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }

        #chatbot-close:hover {
            opacity: 0.8;
        }

        .chatbot-body {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 12px;
            display: flex;
            flex-direction: column;
            background: #fff;
        }

        .chatbot-body::-webkit-scrollbar {
            width: 8px;
        }

        .chatbot-body::-webkit-scrollbar-track {
            background: #f5f5f5;
        }

        .chatbot-body::-webkit-scrollbar-thumb {
            background: #d7d7d7;
            border-radius: 4px;
        }

        .chatbot-body::-webkit-scrollbar-thumb:hover {
            background: #b4b4b4;
        }

        #messages {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 7px;
        }

        /* Mensaje BOT */
        .bot-msg {
            align-self: flex-start;
            max-width: 75%;
            margin: 7px 0px;
            background: #f5f5f5;
            color: #8f8f8f;
            padding: 8px 12px;
            border-radius: 10px;
            font-size: 14px;
            line-height: 1.4;
            border: none;
            word-wrap: break-word;
            word-break: break-word;
        }

        /* Mensaje USUARIO */
        .user-msg {
            align-self: flex-end;
            max-width: 75%;
            background: #673ab7;
            color: #ffffff;
            padding: 8px 12px;
            border-radius: 10px 10px 0 10px;
            font-size: 14px;
            line-height: 1.4;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
            word-wrap: break-word;
            word-break: break-word;
        }

        .chatbot-footer {
            display: flex;
            border-top: 1px solid #ddd;
            padding: 10px;
        }

        #message {
            margin: 0;
            border: solid 1px #d7d7d7;
            border-radius: 10px;
            padding: 10px 12px;
            flex: 1;
            height: 40px;
            font-size: 14px;
            font-family: 'Sora', sans-serif;
            box-sizing: border-box;
            background: #f5f5f5;
            outline: none;
        }

        #message::placeholder {
            color: #b4b4b4;
        }

        #message:focus {
            border-color: #3b31ff;
            background: #fff;
        }

        #send {
            border: none;
            border-radius: 10px;
            background: #3b31ff;
            color: #fff;
            height: 40px;
            width: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        #send:hover {
            background: #2f28d9;
            transform: scale(1.05);
        }

        #send:active {
            transform: scale(0.95);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #8f8f8f;
            font-family: 'Sora', sans-serif;
        }

        .empty-state h2 {
            font-size: 1.15em;
            font-weight: 500;
            margin-bottom: 10px;
            color: #8f8f8f;
        }

        .empty-state p {
            font-size: 14px;
            font-weight: 400;
        }

        /* Animación de entrada */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .bot-msg, .user-msg {
            animation: slideIn 0.3s ease-out;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .chatbot-header {
                padding: 8px;
            }

            .cubibot-icon svg {
                width: 40px;
                height: 40px;
            }

            .cubibot-title {
                font-size: 1rem;
            }

            .cubibot-status {
                font-size: 0.8rem;
            }

            .bot-msg, .user-msg {
                font-size: 13px;
                padding: 7px 10px;
            }

            #message {
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chatbot-header">
            <div class="cubibot-header">
                <div class="cubibot-icon">
                    <svg width="50" height="50" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="25" cy="25" r="22" fill="#5D55FF" stroke="white" stroke-width="6"></circle>
                        <g clip-path="url(#clip0_36_199)">
                        <path d="M22.8494 17.6528C22.8494 17.0984 22.8449 16.6231 22.8507 16.1478C22.8562 15.7067 23.0841 15.4554 23.5291 15.4549C24.7683 15.4531 25.1363 15.2616 25.0597 16.8417C25.0475 17.093 25.0579 17.3457 25.0579 17.6528C26.7574 17.6528 28.4055 17.6474 30.0541 17.6569C30.4374 17.6591 30.828 17.6767 31.2027 17.7508C33.1166 18.1286 34.5391 19.7842 34.5292 21.7249C34.5211 23.3153 34.4418 24.9088 34.3089 26.4938C34.2382 27.336 33.9153 27.4678 33.0982 27.2029C32.0513 26.8639 32.1158 26.8625 32.2022 25.7708C32.3104 24.4034 32.3347 23.0248 32.3131 21.6525C32.2982 20.697 31.4856 19.9492 30.5298 19.8651C30.4019 19.8539 30.2726 19.8579 30.1442 19.8575C26.0097 19.8575 21.8756 19.8557 17.741 19.8584C16.3793 19.8593 15.5623 20.6547 15.5776 22.0032C15.5942 23.5014 15.451 25.0073 15.8744 26.4857C16.8708 29.9656 19.9941 32.3658 23.6192 32.4049C23.6377 32.4049 23.6561 32.4067 23.6741 32.4054C25.2691 32.3155 25.0579 32.7332 25.0484 33.9962C25.0457 34.3834 24.793 34.5893 24.4057 34.6091C18.6306 34.9077 14.1713 30.8289 13.4984 25.8095C13.3069 24.3836 13.329 22.9151 13.3921 21.4726C13.4835 19.3736 15.3244 17.6874 17.4451 17.6582C19.0252 17.6366 20.6053 17.6533 22.1859 17.6528C22.385 17.6528 22.5841 17.6528 22.8494 17.6528Z" fill="white"></path>
                        <path d="M31.9441 29.4104C32.1148 29.7566 32.2382 29.9698 32.3283 30.1959C33.0205 31.9379 34.2437 33.1525 35.998 33.8399C36.2228 33.928 36.4331 34.0526 36.7962 34.2329C36.4448 34.4114 36.2507 34.531 36.0417 34.6128C33.3539 35.6655 33.3801 35.5139 32.3094 38.3355C32.2769 38.4209 32.2571 38.5163 32.2049 38.5882C32.1247 38.6988 32.0215 38.7932 31.9283 38.8949C31.8364 38.7941 31.7089 38.7087 31.6585 38.5904C31.4279 38.0522 31.2103 37.5081 31.004 36.96C30.6743 36.0837 30.0802 35.4838 29.1982 35.1574C28.6482 34.9541 28.1041 34.7347 27.5649 34.504C27.4469 34.4537 27.3627 34.3251 27.2627 34.2324C27.364 34.1403 27.4505 34.0126 27.5694 33.9618C28.1086 33.7315 28.6523 33.5103 29.2032 33.3093C30.0887 32.9856 30.6774 32.3803 31.0054 31.5049C31.1914 31.008 31.3864 30.5138 31.5914 30.0246C31.6635 29.8529 31.777 29.6982 31.9441 29.4104Z" fill="white"></path>
                        <path d="M20.405 23.3797C21.3878 23.3703 22.1923 24.1689 22.1878 25.1495C22.1833 26.1073 21.4013 26.8928 20.4423 26.9023C19.4608 26.9122 18.655 26.1118 18.6591 25.132C18.6636 24.1747 19.446 23.3887 20.4045 23.3797H20.405Z" fill="white"></path>
                        <path d="M27.5087 26.9024C26.5272 26.9158 25.7178 26.1191 25.7183 25.1393C25.7192 24.1815 26.4984 23.3924 27.4565 23.3798C28.4393 23.3668 29.2474 24.1622 29.2465 25.1424C29.2461 26.1006 28.4673 26.8893 27.5083 26.9024H27.5087Z" fill="white"></path>
                        </g>
                        <defs>
                        <clipPath id="clip0_36_199">
                        <rect width="23.4488" height="23.4488" fill="white" transform="translate(13.3469 15.4462)"></rect>
                        </clipPath>
                        </defs>
                    </svg>
                </div>
                <div style="margin-top:auto;margin-bottom:auto;margin-left:8px;margin-right:8px;">
                    <h3 class="cubibot-title">Chat en Vivo</h3>
                    <p class="cubibot-status"><span id="userCount">0</span> en línea</p>
                </div>
            </div>
            <button id="chatbot-close">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8.56495 8.56496L11.9403 11.9403M11.9403 11.9403L15.3157 15.3157M11.9403 11.9403L8.56495 15.3157M11.9403 11.9403L15.3157 8.56496M4.34576 19.5349C3.34843 18.5375 2.55731 17.3535 2.01756 16.0504C1.47781 14.7474 1.2 13.3507 1.2 11.9403C1.2 10.5299 1.47781 9.13325 2.01756 7.83017C2.55731 6.5271 3.34843 5.34309 4.34576 4.34576C5.34309 3.34844 6.5271 2.55731 7.83017 2.01756C9.13324 1.47781 10.5299 1.2 11.9403 1.2C13.3507 1.2 14.7474 1.47781 16.0504 2.01756C17.3535 2.55731 18.5375 3.34844 19.5349 4.34576C21.549 6.35996 22.6806 9.0918 22.6806 11.9403C22.6806 14.7888 21.549 17.5207 19.5349 19.5349C17.5207 21.5491 14.7888 22.6806 11.9403 22.6806C9.0918 22.6806 6.35996 21.5491 4.34576 19.5349Z" stroke="#6058FF" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
            </button>
        </div>

        <div class="chatbot-body" id="chatbot-messages">
            <ul id="messages">
                <div class="empty-state">
                    <!-- <h2>¿Qué te gustaría hacer hoy?</h2>
                    <p>Haz <b>clic</b> o escribe tu mensaje para continuar</p> -->
                </div>
            </ul>
        </div>

        <div class="chatbot-footer">
            <input type="text" id="message" placeholder="Escribe tu mensaje..." autocomplete="off">
            <button id="send">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4.49699 20.835L21.007 13.472C22.331 12.882 22.331 11.118 21.007 10.528L4.49699 3.16397C3.00199 2.49697 1.44999 3.97797 2.19099 5.36597L5.34299 11.27C5.58799 11.729 5.58799 12.27 5.34299 12.728L2.19099 18.632C1.45099 20.02 3.00099 21.503 4.49699 20.835Z" fill="white"></path>
                </svg>
            </button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const messagesContainer = document.getElementById('messages');
        const emptyState = document.querySelector('.empty-state');
        const messageInput = document.getElementById('message');
        const sendButton = document.getElementById('send');
        const userCountEl = document.getElementById('userCount');

        let messageCount = 0;

        // Función para enviar mensaje
        function sendMessage() {
            const msg = messageInput.value.trim();
            if (msg) {
                socket.emit('chat_message', msg);
                messageInput.value = '';
                messageInput.focus();
            }
        }

        // Evento de botón enviar
        sendButton.addEventListener('click', sendMessage);

        // Evento de Enter en input
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Recibir mensajes
        socket.on('chat_message', (msg) => {
            // Ocultar estado vacío
            if (emptyState) {
                emptyState.remove();
            }

            const li = document.createElement('li');
            // Alternar entre bot-msg y user-msg para demostración
            // En producción, necesitarías identificar el emisor
            li.className = messageCount % 2 === 0 ? 'user-msg' : 'bot-msg';
            li.textContent = msg;
            messagesContainer.appendChild(li);
            messageCount++;

            // Auto-scroll al último mensaje
            document.getElementById('chatbot-messages').scrollTop = document.getElementById('chatbot-messages').scrollHeight;
        });

        // Actualizar contador de usuarios
        socket.on('connect', () => {
            updateUserCount();
        });

        function updateUserCount() {
            // Simulación - en producción necesitarías emitir eventos del servidor
            const count = Math.floor(Math.random() * 10) + 1;
            userCountEl.textContent = count;
        }

        // Focus automático en el input
        messageInput.focus();

        // Actualizar contador cada 30 segundos
        setInterval(updateUserCount, 30000);
    </script>
</body>
</html>
